// run onload of the doc
const project = require("projects");
require("./sidebar");
require("./createChild");

project.updateVisualList();

window.addEventListener("hashchange", function(){
    onHashChange();
});
onHashChange();

function onHashChange(){
    let hash = location.hash;
    if(hash.includes("#project_")){
        let name = decodeURI(hash.replace("#project_", ""));
        console.log(name);
    }
}

/**
 * add event for the new project form
 */
$("#new-project-form").on("submit", function(event){
    event.preventDefault();

    project.new($( this ).serializeArray()).then(function(file){
        // open the created project
        let newFile = project.open(file.name);
        newFile.setData(file);

        $('#projectsModal').modal('hide');
        $("#new-project-form-warning-div").hide();
    }).catch(function(err){
        let msg = err.message;
        $("#new-project-form-warning").text(msg);
        $("#new-project-form-warning-div").show();
    });
});


// get and save the demo file
fetch("demo.json").then(function(response){
    return response.json();

}).then(function(data){
    project.save(data);
    // open the file
    let name = data.name;
    project.open(name);

}).catch(function(err){
    console.error(err);
});

let div = document.getElementById("files-list-menu");

const FileTree = require("filetree");

// let fileTree = new FileTree(div, [
//     {
//         type: "file",
//         name: "File 1",
//         contents: ""
//     }, {
//         type: "dir",
//         name: "Folder 1",
//         contents: [
//             {
//                 type: "file",
//                 name: "File 2",
//                 contents: ""
//             }
//         ]
//     }
// ], {
//     name: "Functions"
// });

// fileTree.on("change", function(){
//     console.log("Changed");
// });

// fileTree.on("selected", function(current){
//     // console.log(current);
// });

// fileTree.on("file-opened", function(current){
//     // console.log(current);
// });

// fileTree.on("dir-opened", function(current){
//     // console.log(current);
// });

// fileTree.on("new-file", function(){
//     // console.log("new file");
// });
// fileTree.on("new-dir", function(){
//     // console.log("new dir");
// });
// fileTree.on("new", function(){
//     // console.log("new file or dir");
// });


// console.log(fileTree);