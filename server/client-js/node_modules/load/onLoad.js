// run onload of the doc
const project = require("projects");
window.projects = project;

// window.modal = require("modal");

require("./sidebar");
require("./createChild");

project.updateVisualList();

window.addEventListener("hashchange", function () {
    onHashChange();
});
onHashChange();

function onHashChange() {
    let hash = location.hash;
    if (hash.includes("#project_")) {
        let name = decodeURI(hash.replace("#project_", ""));

        project.open(name)
            .catch(function (err) {
                project.loadDemo();
            });
        console.log(name);
    } else {
        if (!global.openFile) {
            // get and save the demo file
            project.loadDemo();
        }
    }
}

/**
 * add event for the new project form
 */
$("#new-project-form").on("submit", function (event) {
    event.preventDefault();
    let file = null;

    project.new($(this).serializeArray())
        .then(function (f) {
            console.log(f);

            $('#projectsModal').modal('hide');
            $("#new-project-form-warning-div").hide();
        })
        .catch(function (err) {
            let msg = err.message;
            $("#new-project-form-warning").text(msg);
            $("#new-project-form-warning-div").show();
        });
});

const workspace = require("blockly");

workspace.start();