const colours = require("blockly/colour");

Blockly.Blocks['setblock'] = {
    init: function () {
        this.jsonInit({
            "message0": '/setblock coords %1',
            "args0": [
                {
                    "type": "input_value",
                    "name": "COORDS",
                    "check": "String"
                }
            ],
            "message1": "block %1",
            "args1": [{
                "type": "input_value",
                "name": "BLOCK",
                "check": "String"
            }],
            "message2": "mode %1",
            "args2": [{
                "type": "field_dropdown",
                "name": "MODE",
                "options": [
                    ["Replace", "replace"],
                    ["Keep", "keep"],
                    ["Destroy", "destroy"]
                ]
            }],
            "previousStatement": "Action",
            "nextStatement": "Action",
            "colour": colours.blocks,
            "tooltip": "Set a block at location",
            "helpUrl": "https://minecraft.gamepedia.com/Commands/setblock"
        });
    }
};

Blockly.Functions["setblock"] = function (block) {
    // Search the text for a substring.
    let coords = Blockly.Functions.valueToCode(block, 'COORDS', Blockly.Functions.ORDER_NONE) || "~ ~ ~";

    let blockName = Blockly.Functions.valueToCode(block, 'BLOCK', Blockly.Functions.ORDER_NONE) || "minecraft:stone";

    let mode = block.getFieldValue("MODE") || "";

    let command = "/setblock " + coords + " " + blockName + " " + mode + "\n";
    return command;
};